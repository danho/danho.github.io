<!DOCTYPE html>
<html lang="en">
<head>
    <!-- JQuery CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

    <!-- Bootstrap CDN -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

    <!-- Site CSS -->
    <link rel="stylesheet" href="site.css" />

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>
        D
    </title>
</head>

<body>
    <div class="container">
        <div class="col-md-8 col-md-offset-2">
            <div class="row">
                <nav class="navbar navbar-clear">
                    <div class="navbar-header">
                        <div class="col-md-12">
                            <a class="black" href="index.html"><h3><strong>Danny Ho</strong></h3></a>
                            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                                <span class="icon-bar black"></span>
                                <span class="icon-bar black"></span>
                                <span class="icon-bar black"></span>
                            </button>
                        </div>
                    </div>
                    <div class="navbar-collapse collapse navbar-clear" id="myNavbar">
                        <ul class="nav navbar-nav navbar-right">
                            <li><a class="black" href="About.html">About</a></li>
                            <li>
                                <a class="black" target="_blank" href="https://github.com/danho">GitHub</a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="col-md-8 col-md-offset-2">
            <a data-toggle="collapse" href="#collapse1" aria-expanded="false" aria-controls="collapse1" class="black">
                <h4>Partial Pages in ASP.NET Web Forms</h4>
            </a>
            <div class="collapse in" id="collapse1">
                <br />
                <p>
                    Was tasked with implementing a Bootstrap modal in a ASP.NET Web Forms project. Caveat was since the modal was used in multiple web pages, it needed to be a single page for the modal and other web pages
                    would reference it to reduce duplication.
                </p>
                <p>
                    Did some research and found a few suggested solutions using JQuery <code>html()</code> function or <code>load()</code> function to direclty inject html into the page. This would work if the modal was all
                    static text but Bootstrap modals also require JavaScript to be interactive. In addition, when you use these two functions to inject html into the page after the page has been loaded, JQuery would not be
                    able to retrieve the id's generated.
                </p>
                <p>
                    A better solution is something similar to ASP.NET MVC partial pages. You can use the <code>#include</code> directive to insert the content of another page on the server side so the client would receive a
                    sinlge page with all the content, instead of loading the content using JavaScript on the client side. So you would have one page for the HTML of the modal and one page for the JavaScript for the modal. Example:
                    <br />
                    <br />
                    <code><span class="token punctuation"><</span>script type="text/javascript"<span class="token punctuation">></span></code>
                    <br />
                    &nbsp;&nbsp;<code><span class="token punctuation"><</span>!--#include file ="/js/modal.js"--<span class="token punctuation">></span></code>
                    <br />
                    <code><span class="token punctuation"><</span>/script<span class="token punctuation">></span></code>
                    <br />
                    <br />
                    <code><span class="token punctuation"><</span>div<span class="token punctuation">></span></code>
                    <br />
                    &nbsp;&nbsp;<code><span class="token punctuation"><</span>!--#include file ="/modal.html"--<span class="token punctuation">></span></code>
                    <br />
                    <code><span class="token punctuation"><</span>/div<span class="token punctuation">></span></code>
                </p>
            </div>
        </div>
    </div>
    <br />
    <div class="container">
        <div class="col-md-8 col-md-offset-2">
            <a data-toggle="collapse" href="#collapse2" aria-expanded="false" aria-controls="collapse2" class="black">
                <h4>Convert C# DateTime to JavaScript Date using timestamps</h4>
            </a>
            <div class="collapse" id="collapse2">
                <br />
                <p>
                    JavaScript Date can be created using strings like <code>var d = new Date("2015-01-01");</code>. It can also be created using timestamps like <code>var d = new Date(1136053800000);</code>
                </p>
                <p>
                    The below function is one way to convert C# DateTime to JavaScript Date using timestamps.
                </p>
                <p>
                    <code>var DatetimeMinTimeTicks = (new DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc)).Ticks;</code>
                    <br />
                    <br />
                    <code>public static long DateTimeToJavaScriptDate(DateTime dt)</code>
                    <br />
                    <code>{</code>
                    <br />
                    <code>&nbsp;&nbsp;return (long)((dt.ToUniversalTime().Ticks - DatetimeMinTimeTicks) / 10000);</code>
                    <br />
                    <code>}</code>
                </p>
            </div>
        </div>
    </div>
    <br />
    <div class="container">
        <div class="col-md-8 col-md-offset-2">
            <a data-toggle="collapse" href="#collapse3" aria-expanded="false" aria-controls="collapse3" class="black">
                <h4>Renaming Keys in Entity Framework Code First</h4>
            </a>
            <div class="collapse" id="collapse3">
                <br />
                <p>
                    If you changed the name of a key in your model, for example from <code>Id</code> to <code>ReviewId</code>
                    and then try to add a migration and update the database, Entity Framework might throw an exception like
                    <br />
                    <br />
                    <code>Multiple identity columns specified for table '...'. Only one identity column per table is allowed.</code>
                </p>
                <p>
                    The problem is not with your key name change, it is with the order of operations Entity Framework handles this.
                    If you go to the migration file Entity Framework generated, you will see smething like this
                    <br />
                    <br />
                    <code>public override void Up()</code><br />
                    <code>{</code><br />
                    <code>&nbsp;&nbsp;AddColumn(..., "ReviewId", c => c.Int(nullable: false, identity: true));</code><br />
                    <code>&nbsp;&nbsp;DropPrimaryKey(..., new[] { "Id" });</code><br />
                    <code>&nbsp;&nbsp;AddPrimaryKey(..., new[] { "ReviewId" });</code><br />
                    <code>&nbsp;&nbsp;DropColumn(..., "Id");</code><br />
                    <code>&nbsp;&nbsp;...</code><br />
                    <code>}</code><br />
                    <br />
                    This might look OK since you are dropping the primary key and then adding a new one but the trick is that you need
                    to drop the primary key and the column as well. So reordering the operations like this will work:
                    <br />
                    <br />
                    <code>public override void Up()</code><br />
                    <code>{</code><br />
                    <code>&nbsp;&nbsp;DropPrimaryKey(..., new[] { "Id" });</code><br />
                    <code>&nbsp;&nbsp;DropColumn(..., "Id");</code><br />
                    <code>&nbsp;&nbsp;AddColumn(..., "ReviewId", c => c.Int(nullable: false, identity: true));</code><br />
                    <code>&nbsp;&nbsp;AddPrimaryKey(..., new[] { "ReviewId" });</code><br />
                    <code>&nbsp;&nbsp;...</code><br />
                    <code>}</code><br />
                </p>
            </div>
        </div>
    </div>
</body>
</html>
